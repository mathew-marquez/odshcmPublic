SELECT 
	C.NAME,
	B.EMPLID,
	B.EMPL_RCD,
	B.EFFDT,
	B.POSITION_NBR,
	B.HR_STATUS,
	B.REPORTS_TO AS REPORTS_POSN_NBR,
(CASE 
	WHEN B.REPORTS_TO = '40048214' THEN '10052493'
	WHEN B.REPORTS_TO = '40048872' THEN '10051640'
	WHEN B.REPORTS_TO = '40064684' THEN '10052327'
	WHEN B.REPORTS_TO = '40048214' THEN '10066199'
	WHEN B.REPORTS_TO = '40106787' THEN '10097664'
END) AS MANAGER_ID,
(CASE 
	WHEN B.REPORTS_TO = '40048214' THEN 'Alan Fogelman'
	WHEN B.REPORTS_TO = '40048872' THEN 'Allison Baird-James'
	WHEN B.REPORTS_TO = '40064684' THEN 'Jordan Senko'
	WHEN B.REPORTS_TO = '40048214' THEN 'Peter Whybrow'
	WHEN B.REPORTS_TO = '40106787' THEN 'Adam Fronczek'
END) AS MANAGER_NAME,
	LEFT(B.DEPTID,4) AS DEPT_CODE,
	D.DESCR
FROM 
	PS_JOB B
	LEFT JOIN PS_NAMES C ON C.EMPLID = B.EMPLID
	LEFT JOIN PS_DEPT_TBL D ON D.DEPTID = B.DEPTID
	LEFT JOIN PS_POSITION_DATA A ON A.POSITION_NBR = B.POSITION_NBR
WHERE 
	B.DML_IND <> 'D'
	AND C.DML_IND <> 'D'
	AND D.DML_IND <> 'D'
	AND A.DML_IND <> 'D'
	--AND B.HR_STATUS = 'A'
	--AND A.POSN_STATUS = 'A'
	AND B.BUSINESS_UNIT IN ('LACMP', 'LAMED')
	AND C.NAME_TYPE = 'PRI'
	AND B.EFFDT =
			(SELECT MAX(B2.EFFDT)
			FROM PS_JOB B2
			WHERE B2.EMPLID = B.EMPLID
			AND B2.EMPL_RCD = B.EMPL_RCD
			AND B2.DML_IND <> 'D'
			AND B2.EFFDT <= GETDATE())
	AND B.EFFSEQ =
			(SELECT MAX(B3.EFFSEQ)
			FROM PS_JOB B3
			WHERE B3.EMPLID = B.EMPLID
			AND B3.EMPL_RCD = B.EMPL_RCD
			AND B3.DML_IND <> 'D'
			AND B3.EFFDT = B.EFFDT)
	AND C.EFFDT =
			(SELECT MAX(C2.EFFDT)
			FROM PS_NAMES C2
			WHERE C2.EMPLID = C.EMPLID
			AND C2.NAME_TYPE = 'PRI'
			AND C2.DML_IND <> 'D'
			AND C2.EFFDT <= GETDATE())
	AND D.EFFDT =
			(SELECT MAX(D2.EFFDT)
			FROM PS_DEPT_TBL D2
			WHERE D2.DEPTID = D.DEPTID
			AND D2.DML_IND <> 'D'
			AND D2.EFFDT <= GETDATE())
	AND A.EFFDT =
			(SELECT MAX(A2.EFFDT)
			FROM PS_POSITION_DATA A2
			WHERE A2.POSITION_NBR = A.POSITION_NBR
			AND A2.DML_IND <> 'D'
			AND A2.EFFDT <= GETDATE())
	AND (CASE 
		WHEN B.REPORTS_TO = '40048214' THEN 'Alan Fogelman'
		WHEN B.REPORTS_TO = '40048872' THEN 'Allison Baird-James'
		WHEN B.REPORTS_TO = '40064684' THEN 'Jordan Senko'
		WHEN B.REPORTS_TO = '40048214' THEN 'Peter Whybrow'
		WHEN B.REPORTS_TO = '40106787' THEN 'Adam Fronczek'
	END) IS NOT NULL
GROUP BY
	C.NAME,
	B.EMPLID,
	B.EMPL_RCD,
	B.EFFDT,
	B.POSITION_NBR,
	B.HR_STATUS,
	B.REPORTS_TO,
	B.DEPTID,
	D.DESCR
ORDER BY 
	NAME ASC;


SELECT 				
	A.POSITION_NBR,			
	A.REPORTS_TO AS REPORTS_POSN_NBR,			
(CASE 				
	WHEN A.REPORTS_TO = '40048214' THEN '10052493'			
	WHEN A.REPORTS_TO = '40048872' THEN '10051640'			
	WHEN A.REPORTS_TO = '40064684' THEN '10052327'			
	WHEN A.REPORTS_TO = '40058514' THEN '10066199'			
	WHEN A.REPORTS_TO = '40106787' THEN '10097664'			
END) AS MANAGER_ID,				
(CASE 				
	WHEN A.REPORTS_TO = '40048214' THEN 'Alan Fogelman'			
	WHEN A.REPORTS_TO = '40048872' THEN 'Allison Baird-James'			
	WHEN A.REPORTS_TO = '40064684' THEN 'Jordan Senko'			
	WHEN A.REPORTS_TO = '40058514' THEN 'Peter Whybrow'			
	WHEN A.REPORTS_TO = '40106787' THEN 'Adam Fronczek'			
END) AS MANAGER_NAME,				
	LEFT(A.DEPTID,4) AS DEPT_CODE,			
	D.DESCR			
FROM 				
	PS_POSITION_DATA A			
	LEFT JOIN PS_DEPT_TBL D ON D.DEPTID = A.DEPTID			
	LEFT JOIN PS_ACTN_REASON_TBL E ON E.ACTION_REASON = A.ACTION_REASON			
WHERE 				
		D.DML_IND <> 'D'		
	AND A.DML_IND <> 'D'			
	AND E.DML_IND <> 'D'			
	--AND B.HR_STATUS = 'A'			
	AND A.ACTION_REASON NOT IN ('INA', 'IN1', 'IN2' , 'IN3')			
	AND A.MAX_HEAD_COUNT > 1			
	AND E.ACTION = 'POS'			
	AND D.EFFDT =			
			(SELECT MAX(D2.EFFDT)	
			FROM PS_DEPT_TBL D2	
			WHERE D2.DEPTID = D.DEPTID	
			AND D2.DML_IND <> 'D'	
			AND D2.EFFDT <= GETDATE())	
	AND A.EFFDT =			
			(SELECT MAX(A2.EFFDT)	
			FROM PS_POSITION_DATA A2	
			WHERE A2.POSITION_NBR = A.POSITION_NBR	
			AND A2.DML_IND <> 'D'	
			AND A2.EFFDT <= GETDATE())	
	AND E.EFFDT =			
			(SELECT MAX(E2.EFFDT)	
			FROM PS_ACTN_REASON_TBL E2	
			WHERE E2.ACTION_REASON = E.ACTION_REASON	
			AND E2.ACTION = 'POS'	
			AND E2.DML_IND <> 'D'	
			AND E2.EFFDT <= GETDATE())	
	AND (CASE 			
		WHEN A.REPORTS_TO = '40048214' THEN 'Alan Fogelman'		
		WHEN A.REPORTS_TO = '40048872' THEN 'Allison Baird-James'		
		WHEN A.REPORTS_TO = '40064684' THEN 'Jordan Senko'		
		WHEN A.REPORTS_TO = '40058514' THEN 'Peter Whybrow'		
		WHEN A.REPORTS_TO = '40106787' THEN 'Adam Fronczek'		
	END) IS NOT NULL			
GROUP BY				
	A.POSITION_NBR,			
	A.ACTION_REASON,			
	E.DESCR,			
	A.REPORTS_TO,			
	A.DEPTID,			
	D.DESCR			


SELECT * FROM PS_NAMES WHERE EMPLID IN (10117619, 10047623, 10065775, 10053459)

SELECT B.NAME, C.DESCR FROM PS_JOB A
LEFT JOIN PS_NAMES B ON B.EMPLID = A.EMPLID 
LEFT JOIN PS_POSITION_DATA C ON C.POSITION_NBR = A.POSITION_NBR
WHERE A.DEPTID = '352500' AND A.DML_IND <> 'D' and B.DML_IND <> 'D' AND C.DML_IND <> 'D'
--GROUP BY B.NAME, C.DESCR

SELECT B.* FROM PS_JOB B WHERE B.EMPLID = 10051042
 
AND B.EFFDT =
			(SELECT MAX(B2.EFFDT)
			FROM PS_JOB B2
			WHERE B2.EMPLID = B.EMPLID
			AND B2.EMPL_RCD = B.EMPL_RCD
			AND B2.DML_IND <> 'D'
			AND B2.EFFDT <= GETDATE())
	AND B.EFFSEQ =
			(SELECT MAX(B3.EFFSEQ)
			FROM PS_JOB B3
			WHERE B3.EMPLID = B.EMPLID
			AND B3.EMPL_RCD = B.EMPL_RCD
			AND B3.DML_IND <> 'D'
			AND B3.EFFDT = B.EFFDT)

SELECT * FROM PS_JOB B WHERE EMPLID IN (10196430,10106732,10112586,10067851,10140085,10059410,10061589,10057253,10047192,10059586,10124772,10108155,10191437,10114700,10100155,10133943,10113294,10043007,10058653,10051465,10092860,10054725,10048416,10123871,10105465,10066153,10197205,10114251,10054525,10108596,10067564,10131849,10093049,10051227,10044923,10096615,10123076,10054692,10094369,10060599,10043540,10199255,10092861,10104359,10057575,10103689,10119361,10050553,10058592,10057242,10066283,10124814,10053571,10097877,10139975,10045770,10065637,10063390,10047847,10192428,10059330,10120932,10062087,10050494,10069814,10068741,10133446,10068530,10119129,10092329,10067071,10046219,10059174,10054893,10061307,10126681,10060122,10068543,10054129,10056388,10048680,10118024,10134774,10054024,10140444,10059629,10125747,10113323,10093067,10048670,10069295,10190948,10190923,10049343,10051852,10191551,10055509,10049078,10060975,10133618,10068260,10051195,10041127,10045533,10015042,10192178,10062374,10043178,10096186,10056962,10120340,10058818,10104584,10051462,10102646,10049540,10052800,10062539,10112059,10062078,10068425,10065942,10141029,10104873,10097177,10140107,10051625,10057260,10067991,10067349,10068822,10067727,10060788,10133437,10055244,10043445,10061841,10063097,10061268,10053347,10059168,10100503,10030987,10055564,10057431,10068532,10052204,10083075,10014330,10054865,10130608,10059406,10191046,10117491,10189884,10069367,10096006,10195210,10109301,10067000,10068326,10045469,10119811,10063248,10015663,10103754,10105518,10058729,10102648,10094818,10104053,10123152,10133634,10096037,10061349,10139400,10121133,10116469,10126170,10083081,10068953,10049916,10120032,10113755,10068957,10061331,10189805,10125370,10120049,10105089,10118940,10067266,10051407) 
AND DML_IND <> 'D'
AND B.EFFDT =
			(SELECT MAX(B2.EFFDT)
			FROM PS_JOB B2
			WHERE B2.EMPLID = B.EMPLID
			AND B2.EMPL_RCD = B.EMPL_RCD
			AND B2.DML_IND <> 'D'
			AND B2.EFFDT <= GETDATE())
	AND B.EFFSEQ =
			(SELECT MAX(B3.EFFSEQ)
			FROM PS_JOB B3
			WHERE B3.EMPLID = B.EMPLID
			AND B3.EMPL_RCD = B.EMPL_RCD
			AND B3.DML_IND <> 'D'
			AND B3.EFFDT = B.EFFDT) 


SELECT *
FROM 
	PS_JOB A
WHERE (SELECT CONCAT(A2.EMPLID,'-', A2.EMPL_RCD) FROM PS_JOB A2 IN (10196430-0,10106732-0,10112586-2,10067851-0,10140085-0,10059410-1,10061589-0,10057253-0,10047192-0,10059586-0,10124772-0,10108155-1,10191437-0,10114700-0,10100155-0,10133943-0,10113294-7,10043007-0,10058653-2,10051465-1,10092860-10,10054725-0,10048416-0,10123871-0,10105465-0,10066153-0,10197205-0,10114251-0,10054525-0,10108596-0,10067564-0,10131849-0,10093049-0,10051227-0,10044923-0,10096615-0,10123076-1,10054692-0,10094369-0,10060599-0,10043540-0,10199255-0,10092861-5,10104359-0,10057575-0,10103689-0,10119361-1,10050553-1,10058592-0,10057242-0,10066283-1,10124814-0,10053571-0,10097877-0,10139975-0,10045770-0,10065637-1,10063390-1,10047847-0,10192428-0,10059330-0,10120932-0,10062087-0,10050494-0,10069814-0,10068741-0,10133446-0,10068530-1,10119129-0,10092329-9,10067071-1,10046219-2,10059174-3,10054893-0,10061307-0,10126681-6,10060122-0,10068543-0,10054129-0,10056388-0,10048680-0,10118024-6,10134774-0,10054024-3,10140444-2,10059629-1,10125747-0,10113323-7,10093067-0,10048670-0,10069295-0,10190948-0,10190923-0,10049343-1,10051852-1,10191551-1,10055509-2,10049078-0,10060975-0,10133618-0,10068260-0,10051195-0,10041127-0,10045533-0,10015042-7,10192178-0,10062374-0,10043178-0,10096186-4,10056962-0,10120340-0,10058818-1,10104584-6,10051462-0,10102646-0,10049540-0,10052800-0,10062539-1,10112059-0,10062078-0,10068425-0,10065942-3,10141029-0,10104873-0,10097177-3,10140107-0,10051625-0,10057260-0,10067991-0,10067349-0,10068822-0,10067727-0,10060788-0,10133437-0,10055244-0,10043445-0,10061841-0,10063097-0,10061268-0,10053347-0,10059168-1,10100503-1,10030987-8,10055564-0,10057431-0,10068532-0,10052204-0,10083075-0,10014330-2,10054865-2,10130608-0,10059406-0,10191046-0,10117491-0,10189884-0,10069367-0,10096006-0,10195210-0,10109301-0,10067000-2,10068326-0,10045469-0,10119811-0,10063248-1,10015663-4,10103754-0,10105518-0,10058729-1,10102648-0,10094818-1,10104053-0,10123152-0,10133634-0,10096037-0,10061349-1,10139400-0,10121133-0,10116469-0,10126170-0,10083081-0,10068953-0,10049916-0,10120032-0,10113755-0,10068957-0,10061331-0,10189805-0,10125370-0,10120049-0,10105089-0,10118940-0,10067266-0,10051407-1)
	 A.DML_IND <> 'D'

SELECT * FROM PS_JOB A

SELECT * FROM PS_PERSON;
SELECT 
	A.EMPLID,
	A.DEPTID,
	C.BIRTHDATE,
	B.NAME,
	CONCAT(LEFT(A.DEPTID,4),'-',C.BIRTHDATE)
FROM PS_JOB A
LEFT JOIN PS_PERSON C ON C.EMPLID = A.EMPLID
LEFT JOIN PS_NAMES B ON B.EMPLID = A.EMPLID
WHERE 
A.DML_IND <> 'D'
AND C.DML_IND <> 'D'
AND B.DML_IND <> 'D'
AND A.EFFDT =
			(SELECT MAX(A2.EFFDT)
			FROM PS_JOB A2
			WHERE A2.EMPLID = A.EMPLID
			AND A2.EMPL_RCD = A.EMPL_RCD
			AND A2.DML_IND <> 'D'
			AND A2.EFFDT <= GETDATE())
AND A.EFFSEQ =
			(SELECT MAX(A3.EFFSEQ)
			FROM PS_JOB A3
			WHERE A3.EMPLID = A.EMPLID
			AND A3.EMPL_RCD = A.EMPL_RCD
			AND A3.DML_IND <> 'D'
			AND A3.EFFDT = A.EFFDT) 
AND B.EFFDT =
			(SELECT MAX(B2.EFFDT)
			FROM PS_NAMES B2
			WHERE B2.EMPLID = B.EMPLID
			AND B2.NAME_TYPE = 'PRI'
			AND B2.DML_IND <> 'D'
			AND B2.EFFDT <= GETDATE())
AND B.NAME_TYPE = 'PRI'
AND B.NAME LIKE '%Callistus%'
GROUP BY
	A.EMPLID,
	A.DEPTID,
	C.BIRTHDATE,
	B.NAME

SELECT * FROM PS_PAY_CHECK WHERE OFF_CYCLE = 'Y' AND PAY_END_DT >= '2018-09-23' AND DML_IND <> 'D'
SELECT PAYCHECK_NBR, EMPLID, PAY_END_DT, COUNT(PAYCHECK_NBR) FROM PS_PAY_CHECK WHERE OFF_CYCLE = 'Y' AND PAY_END_DT <= '2019-02-01'
GROUP BY PAYCHECK_NBR, EMPLID, PAY_END_DT HAVING COUNT(PAYCHECK_NBR) >1 ORDER BY PAYCHECK_NBR ASC


SELECT * FROM PS_PAY_DEDUCTION WHERE DEDCD = 'PAYCRD' AND PAY_END_DT >= '2018-09-23' AND DML_IND <> 'D';


SELECT 
A.EMPLID,
A.CHECK_DT,
A.PAY_END_DT,
A.OFF_CYCLE,
B.UC_EXT_SYSTEM_ID,
C.NAME,
A.DEPTID,
E.DESCR,
D.ERNCD,
E.DESCR,
D.EARNS_BEGIN_DT,
D.EARNS_END_DT,
D.EARNINGS
 FROM PS_PAY_CHECK A 
LEFT JOIN PS_UC_EXT_SYSTEM B ON B.EMPLID = A.EMPLID 
LEFT JOIN PS_NAMES C ON C.EMPLID = A.EMPLID
LEFT JOIN PS_DEPT_TBL E ON E.DEPTID = A.DEPTID
INNER JOIN PS_PAY_CHECK_EARNS D ON 
(
D.COMPANY = A.COMPANY
AND D.PAYGROUP = A.PAYGROUP
AND D.PAY_END_DT = A.PAY_END_DT
AND D.OFF_CYCLE = A.OFF_CYCLE
AND D.PAGE_NUM = A.PAGE_NUM
AND D.LINE_NUM = A.LINE_NUM
AND D.SEPCHK = A.SEPCHK
AND D.BUSINESS_UNIT = A.BUSINESS_UNIT
)
LEFT JOIN PS_EARNINGS_TBL F ON F.ERNCD = D.ERNCD
WHERE A.EMPLID = 10112281
AND B.UC_EXT_SYSTEM = 'UCLA_UID'
AND A.PAY_END_DT BETWEEN '2018-09-01' AND '2019-09-30'
AND C.NAME_TYPE = 'PRI'

GROUP BY
A.EMPLID,
A.CHECK_DT,
A.PAY_END_DT,
A.OFF_CYCLE,
B.UC_EXT_SYSTEM_ID,
C.NAME,
A.DEPTID,
E.DESCR,
D.ERNCD,
E.DESCR,
D.EARNS_BEGIN_DT,
D.EARNS_END_DT,
D.EARNINGS

SELECT 
	A.EMPLID,
	A.ORG_INSTANCE_ERN AS A_EMPL_RCD,
	A.POI_TYPE,
	A.ORIG_HIRE_OVR,
	A.ORIG_HIRE_DT,
	A.ORG_INST_SRV_DT,
	B.EMPLID,
	B.EMPL_RCD,
	B.EFFDT,
	B.HR_STATUS
FROM 
	PS_PER_ORG_INST A 
	LEFT JOIN PS_JOB B ON A.EMPLID = B.EMPLID 
WHERE A.ORG_INST_SRV_DT IS NULL
AND A.DML_IND <> 'D'
AND B.DML_IND <> 'D'
AND B.EFFDT =
			(SELECT MAX(B2.EFFDT)
			FROM PS_JOB B2
			WHERE B2.EMPLID = B.EMPLID
			AND B2.EMPL_RCD = B.EMPL_RCD
			AND B2.DML_IND <> 'D'
			AND B2.EFFDT <= GETDATE())
AND B.EFFSEQ =
			(SELECT MAX(B3.EFFSEQ)
			FROM PS_JOB B3
			WHERE B3.EMPLID = B.EMPLID
			AND B3.EMPL_RCD = B.EMPL_RCD
			AND B3.DML_IND <> 'D'
			AND B3.EFFDT = B.EFFDT) 
AND A.ORG_INST_SRV_DT IS NULL
AND B.BUSINESS_UNIT IN ('LAMED', 'LACMP')
GROUP BY 
A.EMPLID,
	A.ORG_INSTANCE_ERN,
	A.POI_TYPE,
	A.ORIG_HIRE_OVR,
	A.ORIG_HIRE_DT,
	A.ORG_INST_SRV_DT,
	B.EMPLID,
	B.EMPL_RCD,
	B.EFFDT,
	B.HR_STATUS

SELECT * FROM PS_PER_ORG_INST WHERE EMPLID = 10002806
SELECT *, POI_TYPE FROM PS_JOB WHERE EMPLID = 10014838







 --AND EMPL_RCD = 0
SELECT * FROM PS_PER_ORG_ASGN WHERE EMPLID = 10127590 
SELECT * FROM PS_PER_ORG_INST WHERE EMPLID = 10109987

SELECT * FROM PS_PER_ORG_INST WHERE ORG_INST_SRV_DT IS NULL

SELECT 
	A.EMPLID,
	A.ORG_INSTANCE_ERN AS A_EMPL_RCD,
	A.POI_TYPE,
	A.ORIG_HIRE_OVR,
	A.ORIG_HIRE_DT,
	A.ORG_INST_SRV_DT,
	B.EMPLID,
	B.EMPL_RCD,
	B.EFFDT,
	B.EMPL_STATUS
FROM 
	PS_PER_ORG_INST A
	LEFT JOIN PS_JOB B ON A.EMPLID = B.EMPLID
WHERE A.ORG_INST_SRV_DT IS NULL
AND A.DML_IND <> 'D'
AND B.DML_IND <> 'D'
AND B.BUSINESS_UNIT IN ('LAMED', 'LACMP')
AND B.EFFDT =
			(SELECT MAX(B2.EFFDT)
			FROM PS_JOB B2
			WHERE B2.EMPLID = B.EMPLID
			AND B2.EMPL_RCD = B.EMPL_RCD
			AND B2.DML_IND <> 'D'
			AND B2.EFFDT <= GETDATE())
AND B.EFFSEQ =
			(SELECT MAX(B3.EFFSEQ)
			FROM PS_JOB B3
			WHERE B3.EMPLID = B.EMPLID
			AND B3.EMPL_RCD = B.EMPL_RCD
			AND B3.DML_IND <> 'D'
			AND B3.EFFDT = B.EFFDT) 
AND B.EMPL_STATUS IN ( 'T', 'R')
AND A.EMPLID = 10003865
ORDER BY A.EMPLID

SELECT A.EMPLID,
	A.ORG_INSTANCE_ERN AS A_EMPL_RCD,
	A.POI_TYPE,
	A.ORIG_HIRE_OVR,
	A.ORIG_HIRE_DT,
	A.ORG_INST_SRV_DT,
	B.EMPLID,
	B.EMPL_RCD,
	B.EFFDT,
	B.EMPL_STATUS
FROM PS_PER_ORG_INST A
LEFT JOIN PS_JOB B ON A.EMPLID = B.EMPLID
WHERE ORG_INST_SRV_DT IS NULL 
AND A.DML_IND <> 'D' AND B.DML_IND <> 'D'AND B.EFFDT =
			(SELECT MAX(B2.EFFDT)
			FROM PS_JOB B2
			WHERE B2.EMPLID = B.EMPLID
			AND B2.EMPL_RCD = B.EMPL_RCD
			AND B2.DML_IND <> 'D'
			AND B2.EMPL_STATUS IN ('T' , 'R' , 'D')
			AND B2.EFFDT <= GETDATE())
AND B.EFFSEQ =
			(SELECT MAX(B3.EFFSEQ)
			FROM PS_JOB B3
			WHERE B3.EMPLID = B.EMPLID
			AND B3.EMPL_RCD = B.EMPL_RCD
			AND B3.DML_IND <> 'D'
			AND B3.EMPL_STATUS IN ('T' , 'R' , 'D')
			AND B3.EFFDT = B.EFFDT)
AND B.EMPL_STATUS IN ('T' , 'R' , 'D')
AND B.BUSINESS_UNIT IN ('LACMP', 'LAMED')
AND A.ORG_INSTANCE_ERN = B.EMPL_RCD


SELECT PS_PER_ORG_INST.EMPLID,
	PS_PER_ORG_INST.ORG_INSTANCE_ERN AS A_EMPL_RCD,
	PS_PER_ORG_INST.POI_TYPE,
	PS_PER_ORG_INST.ORIG_HIRE_OVR,
	PS_PER_ORG_INST.ORIG_HIRE_DT,
	PS_PER_ORG_INST.ORG_INST_SRV_DT,
	PS_JOB.EMPLID,
	PS_JOB.EMPL_RCD,
	PS_JOB.EFFDT,
	PS_JOB.EMPL_STATUS 
FROM PS_PER_ORG_INST, PS_JOB 
WHERE PS_JOB.EMPLID = PS_PER_ORG_INST.EMPLID 
	AND PS_JOB.EMPL_RCD = PS_PER_ORG_INST.ORG_INSTANCE_ERN 
	AND ORG_INST_SRV_DT IS NULL 
	AND PS_JOB.DML_IND <> 'D' 
	AND PS_PER_ORG_INST.DML_IND <> 'D'
	AND PS_JOB.BUSINESS_UNIT IN ('LACMP','LAMED')
AND PS_JOB.EFFDT =
			(SELECT MAX(B2.EFFDT)
			FROM PS_JOB B2
			WHERE B2.EMPLID = PS_JOB.EMPLID
			AND B2.EMPL_RCD = PS_JOB.EMPL_RCD
			AND B2.DML_IND <> 'D'
			AND B2.EFFDT <= GETDATE())
AND PS_JOB.EFFSEQ =
			(SELECT MAX(B3.EFFSEQ)
			FROM PS_JOB B3
			WHERE B3.EMPLID = PS_JOB.EMPLID
			AND B3.EMPL_RCD = PS_JOB.EMPL_RCD
			AND B3.DML_IND <> 'D'
			AND B3.EFFDT = PS_JOB.EFFDT)

SELECT 
	A.EMPLID,
	A.ORG_INSTANCE_ERN AS A_EMPL_RCD,
	A.POI_TYPE,
	A.ORIG_HIRE_OVR,
	A.ORIG_HIRE_DT,
	A.ORG_INST_SRV_DT,
	B.EMPLID,
	B.EMPL_RCD,
	B.EFFDT,
	B.EMPL_STATUS
FROM PS_PER_ORG_INST A
LEFT JOIN PS_JOB B ON A.EMPLID = B.EMPLID
WHERE ORG_INST_SRV_DT IS NULL 
AND A.DML_IND <> 'D' 
AND B.DML_IND <> 'D'
AND B.EFFDT =
			(SELECT MAX(B2.EFFDT)
			FROM PS_JOB B2
			WHERE B2.EMPLID = B.EMPLID
			AND B2.EMPL_RCD = B.EMPL_RCD
			AND B2.DML_IND <> 'D'
			AND B2.EFFDT <= GETDATE())
AND B.EFFSEQ =
			(SELECT MAX(B3.EFFSEQ)
			FROM PS_JOB B3
			WHERE B3.EMPLID = B.EMPLID
			AND B3.EMPL_RCD = B.EMPL_RCD
			AND B3.DML_IND <> 'D'
			AND B3.EFFDT = B.EFFDT)
AND B.BUSINESS_UNIT IN ('LACMP', 'LAMED')
AND A.ORG_INSTANCE_ERN = B.EMPL_RCD
AND B.EMPL_STATUS NOT IN ('T','D','R')

SELECT * FROM PS_JOB WHERE EMPLID = 10043498